{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:best-practices"
  ],
  "prConcurrentLimit": 10,
  "prHourlyLimit": 2,
  "env": {
    // Forces Stable Cargo to accept unstable features
    // https://doc.rust-lang.org/beta/unstable-book/compiler-environment-variables/RUSTC_BOOTSTRAP.html
    // This doesn't affect how renovate finds dependencies but it allows it to correctly build the artifacts
    // Otherwise we always a get a failure in CI so automerges wouldn't be possible
    "RUSTC_BOOTSTRAP": "1"
  },
  // If no rules matches add ci-build:small label
  "labels": ["ci-build:small"],
  "packageRules": [
    {
      // Disable renovate for the packages we have patches for
      "matchPackageNames": [
        // embassy forks
        "cyw43",
        "embassy-hal-internal",
        "embassy-nrf",
        "embassy-net",
        "embassy-rp",
        "embassy-stm32",
        "embassy-time",

        // esp hal forks
        "esp-alloc",
        "esp-bootloader-esp-idf",
        "esp-hal",
        "esp-metadata-generated",
        "esp-println",
        "esp-radio",
        "esp-radio-rtos-driver",
        "esp-rom-sys",
        "esp-sync",
        "xtensa-lx-rt"
      ],
      "enabled": false
    },
    // Packages that contain nrf will get a ci-build:nrf label
    {
      "matchPackageNames" : [ "/^.*nrf.*/i" ],
      "labels": ["ci-build:nrf"]
    },
    // Packages that start with esp- will get a ci-build:esp label
    {
      "matchPackageNames" : [ "/^esp-.*/i" ],
      "labels": ["ci-build:esp"]
    },
    // Packages that contains stm32 will get a ci-build:stm32 label
    {
      "matchPackageNames" : [ "/^.*stm32.*/i" ],
      "labels": ["ci-build:stm32"]
    },
    // Packages that end with -rp will get a ci-build:rp label
    {
      "matchPackageNames" : [ "/^.*-rp$/i" ],
      "labels": ["ci-build:rp"]
    },
    // GHA updates skip build CI
    {
      "matchManagers": ["github-actions"],
      "labels": ["ci-build:skip"]
    },
    // Nothing updates i.e. version/digest pinning skip build CI
    {
      "matchUpdateTypes": ["pinDigest", "pin"],
      "labels": ["ci-build:skip"]
    },
    // Cargo Crates that have a pinned rev probably can't correctly be updated by renovate
    {
      "matchManagers": ["cargo"],
      "matchUpdateTypes": ["digest"],
      enabled: false
    }
  ],
  // Add a 'renovate' label to every PR for the matrix bot
  // and add 'changelog:skip' label for the check-changelog CI job
  "addLabels": ["renovate", "changelog:skip"]
  // TODO: uncomment once confident that renovates works properly
  // "patch": {
  //   "automerge": true
  // }
  // // automerge on Monday Mornings
  // "automergeSchedule": [
  //  "* 0-3 * * 1"
  //]
}
