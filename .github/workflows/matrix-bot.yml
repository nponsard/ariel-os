name: Matrix bot
on:
  pull_request_target:
    types: [opened, ready_for_review, closed]

jobs:
  new-pr:
    if: github.event.action == 'opened' && github.repository == 'ariel-os/ariel-os'
    runs-on: ubuntu-latest
    continue-on-error: true
    env:
      message_label: ${{ github.event.pull_request.draft && '‚ú® New draft PR' || '‚ú®‚è© New PR' }}
    steps:
      - name: send message
        uses: ariel-os/Matrix-Message@3c84df7ffc60ec4eb6431bd2a6cbc25ddc7999b3 # v0.0.4
        with:
          room_id: ${{ secrets.MATRIX_ROOM_ID }}
          access_token: ${{ secrets.MATRIX_ACCESS_TOKEN }}
          message: "${{ env.message_label }}: [${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }})"
          server: "matrix.org"
          message_type: "notice"

  ready-for-review-pr:
    if: github.event.action == 'ready_for_review' && github.repository == 'ariel-os/ariel-os'
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: send message
        uses: ariel-os/Matrix-Message@3c84df7ffc60ec4eb6431bd2a6cbc25ddc7999b3 # v0.0.4
        with:
          room_id: ${{ secrets.MATRIX_ROOM_ID }}
          access_token: ${{ secrets.MATRIX_ACCESS_TOKEN }}
          message: "‚è© PR is now ready for review: [${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }})"
          server: "matrix.org"
          message_type: "notice"

  merged-pr:
    if: github.event.action == 'closed' && github.event.pull_request.merged == true && github.repository == 'ariel-os/ariel-os'
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: send message
        uses: ariel-os/Matrix-Message@3c84df7ffc60ec4eb6431bd2a6cbc25ddc7999b3 # v0.0.4
        with:
          room_id: ${{ secrets.MATRIX_ROOM_ID }}
          access_token: ${{ secrets.MATRIX_ACCESS_TOKEN }}
          message: "üöÄ PR merged: [${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }})"
          server: "matrix.org"
          message_type: "notice"

  abandoned-pr:
    if: github.event.action == 'closed' && github.event.pull_request.merged == false && github.repository == 'ariel-os/ariel-os'
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: send message
        uses: ariel-os/Matrix-Message@3c84df7ffc60ec4eb6431bd2a6cbc25ddc7999b3 # v0.0.4
        with:
          room_id: ${{ secrets.MATRIX_ROOM_ID }}
          access_token: ${{ secrets.MATRIX_ACCESS_TOKEN }}
          message: "‚ùå PR closed without merging: [${{ github.event.pull_request.title }}](${{ github.event.pull_request.html_url }})"
          server: "matrix.org"
          message_type: "notice"
